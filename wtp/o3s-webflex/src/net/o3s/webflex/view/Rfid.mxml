<?xml version="1.0" encoding="utf-8"?>
<!--
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- O3S: Open Source Sport Software
- Copyright (C) 2011 Benoit Pelletier
- Contact: btpelletier@gmail.com
-
- This library is free software; you can redistribute it and/or
- modify it under the terms of the GNU Lesser General Public
- License as published by the Free Software Foundation; either
- version 2.1 of the License, or any later version.
-
- This library is distributed in the hope that it will be useful,
- but WITHOUT ANY WARRANTY; without even the implied warranty of
- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- Lesser General Public License for more details.
-
- You should have received a copy of the GNU Lesser General Public
- License along with this library; if not, write to the Free Software
- Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307
- USA
-
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- $Id: pelletib $
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
-->
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
         xmlns:components="net.o3s.webflex.components.*"
         xmlns:util="util.*"
         width="100%" height="100%" creationComplete="init()">

   <mx:Script>
      <![CDATA[
         import mx.collections.ArrayCollection;
         import mx.controls.Alert;
         import mx.events.ItemClickEvent;
         import mx.rpc.events.ResultEvent;
         import mx.utils.ObjectUtil;
    	   import mx.events.CollectionEvent;
         import net.o3s.webflex.components.Util;
         import net.o3s.webflex.bean.Registered;

         [Bindable]
         public var labelIsEmpty:Boolean = true;

		  private var labelInput:String;
        private var rfidInput:String;


         public function init():void {
            refreshAdminData();
         }

         public function refreshAdminData():void {
         }

         private function onFault(ev:Event):void
         {
            Alert.show( ObjectUtil.toString(ev) );
         }

         private function resultSetRfidToLabel(event:ResultEvent):void {

            var registered:Registered = event.result as Registered;

            labelList.addItem({value:TI_labelValue.text,rfid:TI_rfidValue.text});

            L_processing.text = "Association faite !" ;

            TI_labelValue.text="";
            TI_labelValue.errorString="";
            TI_rfidValue.text="";
            TI_rfidValue.errorString="";
				rfidInput=null;
			   labelInput=null;

         }


		  private function sendEvent(event:Event):void {
				  if (labelInput != null && labelInput != "" && rfidInput != null && rfidInput != "") {
				 	 L_processing.text = "Associaton  <" + labelInput + " / " + rfidInput + "> en cours ..." ;
				 	 RO_registering.setRfidToLabel(labelInput,rfidInput);
				  } else {
					  Alert.show("Champ vide","Erreur");
				  }
		  }

		  private function setLabelValue(event:Event):void {
			 labelInput = TI_labelValue.text;
            labelIsEmpty = false;

          }

        private function setRfidValue(event:Event):void {
          rfidInput = TI_rfidValue.text;
          }

		  private function arrColl_collectionChange(evt:CollectionEvent):void {
			  callLater(autoScrollDataGrid);
		  }

		  private function autoScrollDataGrid():void {
			  if (DG_labels) {
				  DG_labels.validateNow();
				  DG_labels.verticalScrollPosition = DG_labels.maxVerticalScrollPosition;
			  }
		  }


      ]]>
   </mx:Script>

   <mx:RemoteObject id="RO_registering" destination="registering" showBusyCursor="true" fault="onFault(event)">
     <mx:method name="setRfidToLabel" result="resultSetRfidToLabel(event)"/>
   </mx:RemoteObject>

	<mx:ArrayCollection id="labelList"
						collectionChange="arrColl_collectionChange(event);" />

   <mx:VBox width="95%" height="60%">

      <components:EventPanel id="MyEventPanel"  width="100%"/>

      <mx:HBox width="100%" height="10%">
         <mx:Panel title="Association Dossard / Rfid" width="100%" height="100%">
            <mx:HBox>
            <mx:Form>

               <mx:FormItem label="Dossard" >
                  <mx:TextInput id="TI_labelValue" width="150" enter="setLabelValue(event);" focusOut="setLabelValue(event);"/>
               </mx:FormItem>

               <mx:FormItem label="RFID" visible="{!labelIsEmpty}" >
                  <mx:TextInput id="TI_rfidValue" width="150" enter="setRfidValue(event);sendEvent(event);" focusOut="setRfidValue(event);"/>
               </mx:FormItem>

            </mx:Form>
            <mx:Label id="L_processing" color="blue" text="" fontSize="50" fontWeight="bold" textAlign="right"/>
            </mx:HBox>
         </mx:Panel>
      </mx:HBox>

      <mx:HBox width="100%" height="70%">
         <mx:Panel width="100%" height="100%" horizontalAlign="center" title="Associations enregistrees">

            <mx:DataGrid id="DG_labels" dataProvider="{labelList}"
                      rowCount="20" verticalScrollPolicy="on" resizableColumns="true" >

               <mx:columns>
                  <mx:DataGridColumn headerText="Value" dataField="value" width="100"/>
                  <mx:DataGridColumn headerText="Date" dataField="rfid" width="150" />
               </mx:columns>

            </mx:DataGrid>

         </mx:Panel>
      </mx:HBox>
   </mx:VBox>
</mx:Canvas>
